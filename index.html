<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ğŸ¤– Moltbook ç§‘æŠ€æƒ…æŠ¥åº“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: { extend: { boxShadow: { glow: "0 0 0 1px rgba(34,211,238,.25), 0 0 30px rgba(34,211,238,.12)" } } }
      };
    </script>
    <style>
      .line-clamp-1 { display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; overflow: hidden; }
      .line-clamp-2 { display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
      /* æ»šåŠ¨æ¡ç¾åŒ– */
      ::-webkit-scrollbar { width: 6px; }
      ::-webkit-scrollbar-track { background: transparent; }
      ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100 font-sans selection:bg-cyan-500/30">
    <div class="pointer-events-none fixed inset-0 overflow-hidden">
      <div class="absolute -top-24 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-cyan-500/10 blur-3xl"></div>
      <div class="absolute -bottom-24 left-1/4 h-[520px] w-[520px] rounded-full bg-fuchsia-500/10 blur-3xl"></div>
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_1px_1px,rgba(148,163,184,.14)_1px,transparent_0)] [background-size:18px_18px] opacity-40"></div>
    </div>

    <main class="relative mx-auto max-w-6xl px-4 py-10">
      <header class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full border border-cyan-400/20 bg-cyan-400/10 px-3 py-1 text-xs text-cyan-200 shadow-glow">
            <span class="h-1.5 w-1.5 rounded-full bg-cyan-300 animate-pulse"></span>
            æ™ºèƒ½èšåˆ Agent 2026
          </div>
          <h1 class="mt-3 text-2xl font-bold tracking-tight bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent">ğŸ¤– Moltbook ç§‘æŠ€åŠ¨å‘æƒ…æŠ¥åº“</h1>
          <p class="mt-1 text-sm text-slate-400 font-light">å®æ—¶ç›‘æµ‹ Moltbook é¢‘é“åŠ¨æ€ï¼Œç”± AI è‡ªåŠ¨å®ŒæˆåŒè¯­å¯¹é½ä¸æ ¸å¿ƒæ‘˜è¦ã€‚</p>
        </div>
        <div class="rounded-lg border border-slate-800 bg-slate-900/60 px-4 py-2 text-sm backdrop-blur-md">
          <div class="text-slate-500 text-[10px] uppercase tracking-wider font-bold">Last Sync</div>
          <div id="last_time" class="mt-0.5 font-medium text-cyan-400 font-mono tracking-tighter">Fetching...</div>
        </div>
      </header>

      <section class="mt-8 rounded-2xl border border-slate-800 bg-slate-900/40 p-5 shadow-glow backdrop-blur-sm">
        <div class="flex flex-col gap-4 md:flex-row md:items-center">
          <div class="relative flex-1">
            <input
              id="search_input"
              type="text"
              placeholder="æœç´¢é¢˜ç›®ã€é¢‘é“æˆ–çƒ­åº¦å…³é”®è¯..."
              class="w-full rounded-xl border border-slate-800 bg-slate-950/60 px-10 py-2.5 text-sm text-slate-100 outline-none focus:border-cyan-400/40 focus:ring-4 focus:ring-cyan-400/5 transition-all"
            />
            <span class="absolute left-3 top-3 text-slate-500">ğŸ”</span>
          </div>
          <div class="flex items-center gap-3">
            <button id="refresh" class="rounded-xl border border-slate-800 bg-slate-950/40 px-5 py-2.5 text-sm transition hover:bg-slate-800 hover:border-slate-700">åˆ·æ–°ç¼“å­˜</button>
            <button id="save_run" class="rounded-xl bg-cyan-500 px-5 py-2.5 text-sm font-bold text-slate-950 transition hover:bg-cyan-400 active:scale-95">å¼ºåˆ¶é‡æŠ“</button>
          </div>
        </div>
      </section>

      <section class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-3">
        <div class="lg:col-span-1">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-5 shadow-glow h-fit sticky top-6 backdrop-blur-md">
            <h2 class="text-sm font-bold text-slate-100 flex items-center gap-2 mb-4">
              <span class="h-1.5 w-1.5 rounded-full bg-fuchsia-500 shadow-[0_0_10px_rgba(232,121,249,0.5)]"></span>
              ä»Šæ—¥ 10 å¤§æ ¸å¿ƒåŠ¨å‘
            </h2>
            <div id="ai_summary" class="space-y-4 text-[13px] leading-relaxed text-slate-300">
              <div class="animate-pulse text-slate-500 py-4">æ­£åœ¨æ³¨å…¥ AI æ·±åº¦æƒ…æŠ¥...</div>
            </div>
          </div>
        </div>

        <div class="lg:col-span-2">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-6 shadow-glow backdrop-blur-md">
            <div class="flex items-center justify-between border-b border-slate-800 pb-4 mb-2">
              <h2 class="text-sm font-bold text-cyan-400/90 uppercase tracking-widest">å…¨çƒç§‘æŠ€æƒ…æŠ¥æµ</h2>
              <div class="text-[11px] text-slate-500 font-mono">INDEXED: <span id="item_count" class="text-slate-300">0</span> RECS</div>
            </div>
            
            <div id="items_list" class="divide-y divide-slate-800/50">
                </div>
            
            <div class="mt-6 flex items-center justify-between border-t border-slate-800 pt-6">
              <button id="prev_page" class="rounded-lg border border-slate-800 px-4 py-1.5 text-xs font-medium transition hover:bg-slate-800 disabled:opacity-20 disabled:cursor-not-allowed">PREV</button>
              <div id="page_info" class="text-[10px] text-slate-500 font-mono tracking-[0.2em]">PAGE 1 / 1</div>
              <button id="next_page" class="rounded-lg border border-slate-800 px-4 py-1.5 text-xs font-medium transition hover:bg-slate-800 disabled:opacity-20 disabled:cursor-not-allowed">NEXT</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      const $ = (id) => document.getElementById(id);
      let allItems = [];
      let filteredItems = [];
      let currentPage = 1;
      const itemsPerPage = 20;

      // éªŒè¯ç¿»è¯‘å†…å®¹æ˜¯å¦æœ‰æ•ˆ (æ’é™¤ç¬¦å·å’Œå¤ªçŸ­çš„å†…å®¹)
      function isValidTranslation(text) {
        if (!text) return false;
        const noise = ['â–²', 'â–¼', '^', 'posted', 'comments'];
        if (text.length < 5) return false;
        return !noise.some(char => text.toLowerCase().includes(char));
      }

      async function fetchData() {
        const path = `data.json?v=${new Date().getTime()}`;
        try {
          const res = await fetch(path);
          if (!res.ok) throw new Error("File not found");
          const data = await res.json();
          
          allItems = data.items || [];
          filteredItems = [...allItems];
          
          $("last_time").textContent = data.beijing_time || "Unknown";
          renderSummary(data.ai_summary);
          updateDisplay();
        } catch (e) {
          console.error("Fetch error:", e);
          $("ai_summary").innerHTML = '<div class="text-red-400 text-xs">æƒ…æŠ¥æ³¨å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ data.json æ˜¯å¦å­˜åœ¨ã€‚</div>';
        }
      }

      function renderSummary(summary) {
        const el = $("ai_summary");
        if (!summary || summary.length < 10) {
          return el.innerHTML = '<div class="text-slate-500 italic">åˆ†ææŠ¥å‘Šç”Ÿæˆä¸­...</div>';
        }

        // å¤„ç† Markdown æ ¼å¼ï¼šæ¢è¡Œç¬¦è½¬ <br>ï¼Œ** åŠ ç²—è½¬ä¸ºé«˜äº® span
        let html = summary
          .replace(/\n/g, '<br>')
          .replace(/\*\*(.*?)\*\*/g, '<strong class="text-cyan-300 font-bold">$1</strong>');
        
        el.innerHTML = `<div class="bg-slate-950/40 p-4 rounded-xl border border-slate-800/50 leading-relaxed">${html}</div>`;
      }

      function updateDisplay() {
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageItems = filteredItems.slice(start, end);

        const listEl = $("items_list");
        listEl.innerHTML = "";

        if (pageItems.length === 0) {
          listEl.innerHTML = '<div class="py-20 text-center text-slate-600 text-sm font-light tracking-tighter">NO INTELLIGENCE STREAM FOUND</div>';
        }

        pageItems.forEach(it => {
          const card = document.createElement("div");
          card.className = "group py-5 transition-all duration-300 border-b border-slate-900 hover:bg-cyan-500/5 px-2 -mx-2 rounded-lg";
          
          // å®¹é”™å¤„ç†ï¼šå¦‚æœç¿»è¯‘æ˜¯ç¬¦å·ï¼Œç›´æ¥é™çº§æ˜¾ç¤ºè‹±æ–‡æ ‡é¢˜
          const displayTitle = isValidTranslation(it.title_cn) ? it.title_cn : it.title;
          const secondaryTitle = isValidTranslation(it.title_cn) ? it.title : "";

          card.innerHTML = `
            <div class="flex flex-col gap-1">
              <div class="flex items-center gap-2 text-[10px] font-bold uppercase tracking-widest text-slate-500 mb-1">
                <span class="bg-slate-800 text-cyan-400 px-1.5 py-0.5 rounded border border-slate-700">${it.category || 'NEWS'}</span>
                <span class="text-fuchsia-500/80">${it.hot_info || ''}</span>
              </div>
              <a href="${it.url}" target="_blank" class="text-[15px] font-semibold text-slate-100 group-hover:text-cyan-400 transition-colors leading-snug">
                ${displayTitle}
              </a>
              ${secondaryTitle ? `<p class="text-[11px] text-slate-500 italic font-light line-clamp-1 opacity-70 group-hover:opacity-100 mt-1">${secondaryTitle}</p>` : ''}
              <div class="mt-2 flex items-center justify-between">
                <span class="text-[9px] text-slate-700 font-mono truncate max-w-[200px]">${it.url}</span>
                <a href="${it.url}" target="_blank" class="text-[10px] font-bold text-slate-600 hover:text-cyan-400 transition-colors tracking-tighter uppercase">View Intel â†’</a>
              </div>
            </div>
          `;
          listEl.appendChild(card);
        });

        const totalPages = Math.ceil(filteredItems.length / itemsPerPage) || 1;
        $("page_info").textContent = `PAGE ${currentPage} / ${totalPages}`;
        $("item_count").textContent = filteredItems.length;
        $("prev_page").disabled = currentPage === 1;
        $("next_page").disabled = currentPage === totalPages;
      }

      // æœç´¢é€»è¾‘
      $("search_input").oninput = (e) => {
        const query = e.target.value.toLowerCase();
        filteredItems = allItems.filter(it => 
          (it.title && it.title.toLowerCase().includes(query)) || 
          (it.title_cn && it.title_cn.toLowerCase().includes(query)) ||
          (it.category && it.category.toLowerCase().includes(query))
        );
        currentPage = 1;
        updateDisplay();
      };

      $("prev_page").onclick = () => { if(currentPage > 1) { currentPage--; updateDisplay(); window.scrollTo(0,0); } };
      $("next_page").onclick = () => { if(currentPage * itemsPerPage < filteredItems.length) { currentPage++; updateDisplay(); window.scrollTo(0,0); } };
      $("refresh").onclick = () => fetchData();
      $("save_run").onclick = () => alert("è¯·åœ¨ GitHub Actions é¡µé¢æ‰‹åŠ¨ç‚¹å‡» 'Run workflow' ä»¥å¼ºåˆ¶é‡æ–°æŠ“å–ã€‚");

      // åˆå§‹åŒ–
      fetchData();
    </script>
  </body>
</html>
