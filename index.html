<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ğŸ¤– Moltbook ç§‘æŠ€æƒ…æŠ¥åº“</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: { extend: { boxShadow: { glow: "0 0 0 1px rgba(34,211,238,.25), 0 0 30px rgba(34,211,238,.12)" } } }
      };
    </script>
  </head>
  <body class="min-h-screen bg-slate-950 text-slate-100">
    <div class="pointer-events-none fixed inset-0 overflow-hidden">
      <div class="absolute -top-24 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-cyan-500/10 blur-3xl"></div>
      <div class="absolute -bottom-24 left-1/4 h-[520px] w-[520px] rounded-full bg-fuchsia-500/10 blur-3xl"></div>
      <div class="absolute inset-0 bg-[radial-gradient(circle_at_1px_1px,rgba(148,163,184,.14)_1px,transparent_0)] [background-size:18px_18px] opacity-40"></div>
    </div>

    <main class="relative mx-auto max-w-6xl px-4 py-10">
      <header class="flex flex-col gap-2 md:flex-row md:items-end md:justify-between">
        <div>
          <div class="inline-flex items-center gap-2 rounded-full border border-cyan-400/20 bg-cyan-400/10 px-3 py-1 text-xs text-cyan-200 shadow-glow">
            <span class="h-1.5 w-1.5 rounded-full bg-cyan-300"></span>
            æ™ºèƒ½æƒ…æŠ¥ Agent
          </div>
          <h1 class="mt-3 text-2xl font-semibold tracking-tight">ğŸ¤– Moltbook ç§‘æŠ€åŠ¨å‘æƒ…æŠ¥åº“</h1>
          <p class="mt-1 text-sm text-slate-400">å·²å¼€å¯å¢é‡å‚¨å­˜æ¨¡å¼ï¼Œæ”¯æŒå†å²è®°å½•æœç´¢ä¸ç¿»é¡µæŸ¥çœ‹ã€‚</p>
        </div>
        <div class="rounded-lg border border-slate-800 bg-slate-900/40 px-4 py-2 text-sm">
          <div class="text-slate-400">æœ€åæ›´æ–°æ—¶é—´</div>
          <div id="last_time" class="mt-0.5 font-medium text-slate-100">-</div>
        </div>
      </header>

      <section class="mt-8 rounded-2xl border border-slate-800 bg-slate-900/40 p-5 shadow-glow">
        <div class="flex flex-col gap-4 md:flex-row md:items-center">
          <div class="relative flex-1">
            <input
              id="search_input"
              type="text"
              placeholder="æœç´¢å†å²æ–‡ç« æ ‡é¢˜æˆ–å…³é”®è¯..."
              class="w-full rounded-xl border border-slate-800 bg-slate-950/60 px-10 py-2.5 text-sm text-slate-100 outline-none focus:border-cyan-400/40 focus:ring-2 focus:ring-cyan-400/10"
            />
            <span class="absolute left-3 top-3 text-slate-500">ğŸ”</span>
          </div>
          <div class="flex items-center gap-3">
            <button id="refresh" class="rounded-xl border border-slate-800 bg-slate-950/40 px-4 py-2.5 text-sm transition hover:bg-slate-800">åˆ·æ–°</button>
            <button id="save_run" class="rounded-xl bg-cyan-500 px-4 py-2.5 text-sm font-semibold text-slate-950 transition hover:bg-cyan-400">æ‰‹åŠ¨è§¦å‘</button>
          </div>
        </div>
      </section>

      <section class="mt-8 grid grid-cols-1 gap-6 lg:grid-cols-3">
        <div class="lg:col-span-1">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-5 shadow-glow">
            <h2 class="text-sm font-semibold text-slate-100">æœ€æ–° AI è¶‹åŠ¿æ€»ç»“</h2>
            <div id="ai_summary" class="mt-4 text-sm text-slate-200">
              <div class="animate-pulse text-slate-500">ç­‰å¾…äº‘ç«¯åŒæ­¥...</div>
            </div>
          </div>
        </div>

        <div class="lg:col-span-2">
          <div class="rounded-2xl border border-slate-800 bg-slate-900/40 p-5 shadow-glow">
            <div class="flex items-center justify-between border-b border-slate-800 pb-4">
              <h2 class="text-sm font-semibold text-slate-100">æƒ…æŠ¥åˆ—è¡¨</h2>
              <div class="text-xs text-slate-400">å…± <span id="item_count">0</span> æ¡è®°å½•</div>
            </div>
            <div id="items_list" class="divide-y divide-slate-800/50"></div>
            
            <div class="mt-6 flex items-center justify-between border-t border-slate-800 pt-6">
              <button id="prev_page" class="rounded-lg border border-slate-800 px-3 py-1 text-xs transition hover:bg-slate-800 disabled:opacity-30">ä¸Šä¸€é¡µ</button>
              <div id="page_info" class="text-xs text-slate-500">ç¬¬ 1 / 1 é¡µ</div>
              <button id="next_page" class="rounded-lg border border-slate-800 px-3 py-1 text-xs transition hover:bg-slate-800 disabled:opacity-30">ä¸‹ä¸€é¡µ</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <script>
      const $ = (id) => document.getElementById(id);
      const isGitHub = window.location.hostname.includes("github.io");

      let allItems = [];
      let filteredItems = [];
      let currentPage = 1;
      const itemsPerPage = 20;

      // 1. è·å–æ•°æ®
      async function fetchData() {
        const path = isGitHub ? "data.json" : "/api/data";
        try {
          const res = await fetch(path);
          const data = await res.json();
          allItems = data.items || [];
          filteredItems = [...allItems];
          
          $("last_time").textContent = data.beijing_time || "-";
          renderSummary(data.ai_summary);
          updateDisplay();
        } catch (e) {
          console.error("åŠ è½½å¤±è´¥", e);
        }
      }

      // 2. æ¸²æŸ“ AI æ€»ç»“
      function renderSummary(summary) {
        const el = $("ai_summary");
        if (!summary) return el.innerHTML = '<div class="text-slate-500">æš‚æ— æ€»ç»“</div>';
        const lines = summary.split('\n').filter(l => l.trim().startsWith("-"));
        el.innerHTML = `<ul class="space-y-3">${lines.map(l => `<li class="rounded-xl border border-slate-800 bg-slate-950/40 p-3 leading-relaxed">${l.replace(/^-+\s*/, "")}</li>`).join('')}</ul>`;
      }

      // 3. æ¸²æŸ“åˆ—è¡¨ä¸åˆ†é¡µé€»è¾‘
      function updateDisplay() {
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pageItems = filteredItems.slice(start, end);

        const listEl = $("items_list");
        listEl.innerHTML = pageItems.length ? "" : '<div class="py-10 text-center text-slate-500 text-sm">æ²¡æœ‰æ‰¾åˆ°åŒ¹é…çš„æ–‡ç« </div>';

        pageItems.forEach(it => {
          const div = document.createElement("a");
          div.href = it.url;
          div.target = "_blank";
          div.className = "group block py-4 transition hover:bg-slate-900/20";
          div.innerHTML = `
            <div class="flex items-start justify-between gap-4">
              <div class="min-w-0">
                <div class="text-sm font-medium text-slate-100 group-hover:text-cyan-300 transition truncate">${it.title}</div>
                <div class="mt-1 text-xs text-slate-500 truncate">${it.url}</div>
              </div>
              <div class="text-[10px] text-slate-600 border border-slate-800 rounded px-1.5 py-0.5 whitespace-nowrap">å†å²å­˜æ¡£</div>
            </div>
          `;
          listEl.appendChild(div);
        });

        // æ›´æ–°åˆ†é¡µçŠ¶æ€
        const totalPages = Math.ceil(filteredItems.length / itemsPerPage) || 1;
        $("page_info").textContent = `ç¬¬ ${currentPage} / ${totalPages} é¡µ`;
        $("item_count").textContent = filteredItems.length;
        $("prev_page").disabled = currentPage === 1;
        $("next_page").disabled = currentPage === totalPages;
      }

      // 4. æœç´¢åŠŸèƒ½
      $("search_input").oninput = (e) => {
        const query = e.target.value.toLowerCase();
        filteredItems = allItems.filter(it => it.title.toLowerCase().includes(query) || it.url.toLowerCase().includes(query));
        currentPage = 1;
        updateDisplay();
      };

      // 5. äº‹ä»¶ç›‘å¬
      $("prev_page").onclick = () => { if(currentPage > 1) { currentPage--; updateDisplay(); window.scrollTo(0,0); } };
      $("next_page").onclick = () => { if(currentPage * itemsPerPage < filteredItems.length) { currentPage++; updateDisplay(); window.scrollTo(0,0); } };
      $("refresh").onclick = () => fetchData();
      $("save_run").onclick = () => {
        if (isGitHub) alert("è¯·å‰å¾€ GitHub Actions æ‰‹åŠ¨ç‚¹å‡» Run workflowã€‚");
        else fetch("/api/run", {method:"POST"}).then(() => fetchData());
      };

      fetchData();
    </script>
  </body>
</html>
